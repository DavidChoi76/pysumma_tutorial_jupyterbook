
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3. Effect of Forcings on CAMELs Simulations &#8212; pySUMMA Tutorial Jupyter Notebooks</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="1. Modeling the Impact of Simlpe Soil Resistance method on Total Evapotranspiration in the Reynolds Mountain East catchment using pySUMMA" href="SummaModel_ReynoldsAspennStand_StomatalResistance_Basic_Plot.html" />
    <link rel="prev" title="2. Running SUMMA using pySUMMA" href="camels_pysumma.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">pySUMMA Tutorial Jupyter Notebooks</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Overview
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  A. Basci Usage
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="Explore_file_manger.html">
   1. Explore file manger of SUMMA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Explore_decision_file.html">
   2. Explore decision file of SUMMA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Explore_forcing_data.html">
   3. Explore forcing data of SUMMA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Explore_local_attributes_local_parameters_and_basin_parameters.html">
   4. Explore local attributes, local parameters (global hru) and basin parameters (global gru)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Explore_trial_parameters_output_control_and_Noah_MP_tables.html">
   5. Explore Trial parameters, Output control and Noah-MP tables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Simulation_using_output_control.html">
   6. SUMMA simulation using Output Control
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  B. Applications
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="SnowDepth_in_Reynolds.html">
   1. pySUMMA Application for SnowDepth in Reynolds
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Running_Ensembles_of_SUMMA_Simulations.html">
   2. Running ensembles of SUMMA simulations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Parallelizing_Distributed_SUMMA_Simulations.html">
   3. Parallelizing Distributed SUMMA Simulations
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  C. Camels Applications
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="camels_make_input.html">
   1. Creating SUMMA Input using Camels Datasets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="camels_pysumma.html">
   2. Running SUMMA using pySUMMA
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   3. Effect of Forcings on CAMELs Simulations
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  D. Published Articles
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="SummaModel_ReynoldsAspennStand_StomatalResistance_Basic_Plot.html">
   1. Modeling the Impact of Simlpe Soil Resistance method on Total Evapotranspiration in the Reynolds Mountain East catchment using pySUMMA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SummaModel_ReynoldsAspennStand_StomatalResistance_Figure7.html">
   2. Modeling the Impact of Stomatal Resistance Parameterizations on Total Evapotranspiration in the Reynolds Mountain East catchment using pySUMMA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SummaModel_ReynoldsAspenStand_RootDistribution_Figure8_Left.html">
   3. Modeling the Impact of Root Distributions Parameterizations on Total Evapotranspiration in the Reynolds Mountain East catchment using pySUMMA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SummaModel_Reynolds_Evapotranspiration_Figure8_Right.html">
   4. Modeling the Impact of Lateral Flow Parameterizations on Total Evapotranspiration in the Reynolds Mountain East catchment using pySUMMA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SummaModel_Reynolds_runoff_Figure9.html">
   5. Modeling the Impact of Lateral Flow Parameterizations on Basin Wide Runoff in the Reynolds Mountain East catchment using pySUMMA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SummaModel_ReynoldsAspenStand_ShortwaveRadiation_Figure1_Top.html">
   6. Modeling the Impact of the canopy shortwave radiation parameterizations on below canopy shortwave radiation in the Reynolds Mountain East catchment using pySUMMA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SummaModel_ReynoldsAspenStand_ShortwaveRadiation_LAI_Figure1_Bottom.html">
   7. Modeling the Impact of LAI paramter values on simulation of below canopy shortwave radiation in the Reynolds Mountain East catchment using pySUMMA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SummaModel_ReynoldsAspenStand_WindSpeed_Figure2.html">
   8. Modeling the Impact of the canopy wind parameter for the exponential wind profile on simulation of below canopy wind speed in the Reynolds Mountain East catchment using pySUMMA
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/camels_analyze_output.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/DavidChoi76/pysumma_tutorial_jupyterbook.git"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/DavidChoi76/pysumma_tutorial_jupyterbook.git/issues/new?title=Issue%20on%20page%20%2Fcamels_analyze_output.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/DavidChoi76/pysumma_tutorial_jupyterbook.git/master?urlpath=tree/docs/camels_analyze_output.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#you-will-need-to-edit-these-paths-to-be-your-folders">
   3.1. You will need to edit these paths to be your folders
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#make-problem-complexity-choices-here">
   3.2. Make problem complexity choices here:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#manipulating-the-configuration-of-the-pysumma-objects">
   3.3. Manipulating the Configuration of the pySUMMA Objects
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#differences-in-parameter-space-and-model-configuration">
   3.4. Differences in Parameter Space and Model Configuration
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="effect-of-forcings-on-camels-simulations">
<h1><span class="section-number">3. </span>Effect of Forcings on CAMELs Simulations<a class="headerlink" href="#effect-of-forcings-on-camels-simulations" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://www.hydroshare.org/resource/c75ad34da9d642aca6e51126bfff45d1/">HydroShare Resource Link</a></p>
<p>Now we can look at the output and see which forcing variables have the most error. This code is meant to be run on the subset of basins that the ensembles of different model decisions were run on in the <code class="docutils literal notranslate"><span class="pre">camels_pysumma.ipynb</span></code> notebook. This notebook will not run all the way through if the ensembles were not created.</p>
<p>Load the imports.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
</div>
<br>
<div class="section" id="you-will-need-to-edit-these-paths-to-be-your-folders">
<h2><span class="section-number">3.1. </span>You will need to edit these paths to be your folders<a class="headerlink" href="#you-will-need-to-edit-these-paths-to-be-your-folders" title="Permalink to this headline">¶</a></h2>
<br>
Keep these the same.<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;summa_camels&#39;</span><span class="p">)</span>
<span class="n">settings_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">top_folder</span><span class="p">,</span> <span class="s1">&#39;settings.v1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<br>
</div>
<div class="section" id="make-problem-complexity-choices-here">
<h2><span class="section-number">3.2. </span>Make problem complexity choices here:<a class="headerlink" href="#make-problem-complexity-choices-here" title="Permalink to this headline">¶</a></h2>
<p>In the notebook <code class="docutils literal notranslate"><span class="pre">camels_pysumma.ipynb</span></code> you decided if you wanted to run:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">default_prob</span> <span class="pre">=</span> <span class="pre">1</span></code>: the default configuration with the parameters you have.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lhc_prob</span> <span class="pre">=</span> <span class="pre">1</span></code>: the default configuration with exploration of the parameter space.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lhc_config_prob</span> <span class="pre">=</span> <span class="pre">1</span></code>: 8 different configurations (choices that have been seen to affect the model output in previous research) with exploration of the parameter space.</p></li>
</ul>
<p>DO NOT choose one of these to be one here if you did not choose it to be one before.</p>
<p>Again, you can choose all of these to be 1, but each step of complexity will contain the previous problem(s), so it is not necessary. In this notebook it will not make a diffence in the output.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">default_prob</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">lhc_prob</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">lhc_config_prob</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="manipulating-the-configuration-of-the-pysumma-objects">
<h2><span class="section-number">3.3. </span>Manipulating the Configuration of the pySUMMA Objects<a class="headerlink" href="#manipulating-the-configuration-of-the-pysumma-objects" title="Permalink to this headline">¶</a></h2>
<p>Let’s look at some error metrics by HRU, starting with the default paramaters and default configuration.
KGE means perfect agreement if it is 1, and &lt;0 means the mean is a better guess.
Bias means perfect aggreement if it is 0, and larger means larger error.
All data have a small number added so we don’t divide by 0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define truth data set</span>
<span class="k">if</span> <span class="n">lhc_config_prob</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> 
    <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;_configs_latin.nc&#39;</span>
    <span class="n">default_name</span> <span class="o">=</span> <span class="s1">&#39;++BallBerry++0&#39;</span>
    <span class="n">lat_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">default_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>
<span class="k">elif</span> <span class="n">lhc_prob</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;_latin.nc&#39;</span>
    <span class="n">default_name</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>  
    <span class="n">lat_name</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>
<span class="k">elif</span> <span class="n">default_prob</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;_hru.nc&#39;</span>
    <span class="n">default_name</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span>      
<span class="n">sim_truth</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">top_folder</span><span class="o">+</span><span class="s1">&#39;/output/merged_day/NLDAStruth&#39;</span><span class="o">+</span><span class="n">suffix</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get number of HRUs and small add</span>
<span class="n">attrib</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">top_folder</span><span class="o">+</span><span class="s1">&#39;/settings.v1/attributes.nc&#39;</span><span class="p">)</span>
<span class="n">the_hru</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;hruId&#39;</span><span class="p">])</span>
<span class="n">small_add</span> <span class="o">=</span> <span class="mf">1e-10</span> <span class="c1"># so no zeros</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set forcings and create dictionaries</span>
<span class="n">forc_sim</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;windspd&#39;</span><span class="p">,</span><span class="s1">&#39;SWRadAtm&#39;</span><span class="p">,</span><span class="s1">&#39;spechum&#39;</span><span class="p">,</span><span class="s1">&#39;pptrate&#39;</span><span class="p">,</span> <span class="s1">&#39;LWRadAtm&#39;</span><span class="p">,</span><span class="s1">&#39;airtemp&#39;</span><span class="p">,</span><span class="s1">&#39;airpres&#39;</span><span class="p">]</span>
<span class="n">comp_sim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;scalarSurfaceRunoff&#39;</span><span class="p">,</span><span class="s1">&#39;scalarAquiferBaseflow&#39;</span><span class="p">,</span><span class="s1">&#39;scalarInfiltration&#39;</span><span class="p">,</span><span class="s1">&#39;scalarRainPlusMelt&#39;</span><span class="p">,</span><span class="s1">&#39;scalarSoilDrainage&#39;</span><span class="p">,</span>
          <span class="s1">&#39;scalarLatHeatTotal&#39;</span><span class="p">,</span><span class="s1">&#39;scalarSenHeatTotal&#39;</span><span class="p">,</span><span class="s1">&#39;scalarSnowSublimation&#39;</span><span class="p">,</span>
          <span class="s1">&#39;scalarSWE&#39;</span><span class="p">,</span>
          <span class="s1">&#39;scalarCanopyWat&#39;</span><span class="p">,</span>
          <span class="s1">&#39;scalarNetRadiation&#39;</span><span class="p">,</span><span class="s1">&#39;scalarTotalET&#39;</span><span class="p">,</span><span class="s1">&#39;scalarTotalRunoff&#39;</span><span class="p">,</span><span class="s1">&#39;scalarTotalSoilWat&#39;</span><span class="p">]</span>
<span class="n">var_sim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">forc_sim</span><span class="p">,</span> <span class="n">comp_sim</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">col1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;gray&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># definitions for KGE computation</span>
<span class="k">def</span> <span class="nf">covariance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">dims</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dims</span><span class="p">),</span> <span class="n">y</span><span class="o">-</span><span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dims</span><span class="p">),</span> <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">)</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">correlation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">dims</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">covariance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">dims</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dims</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">lhc_prob</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">lhc_config_prob</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="n">decision_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sim_truth</span><span class="p">[</span><span class="s1">&#39;decision&#39;</span><span class="p">])</span> 
<span class="k">else</span><span class="p">:</span> <span class="n">decision_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
<span class="c1">#get names off the files</span>
<span class="n">decision_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sim_truth</span><span class="p">[</span><span class="s1">&#39;decision&#39;</span><span class="p">])</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set up xarray</span>
<span class="n">hrud</span> <span class="o">=</span> <span class="n">sim_truth</span><span class="p">[</span><span class="s1">&#39;hru&#39;</span><span class="p">]</span> <span class="c1">#indices here are 0 to number of basins</span>
<span class="n">shape</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">decision_set</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">hrud</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">))</span>
<span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;decision&#39;</span><span class="p">,</span><span class="s1">&#39;hru&#39;</span><span class="p">,</span><span class="s1">&#39;var&#39;</span><span class="p">)</span>
<span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;decision&#39;</span><span class="p">:</span><span class="n">decision_set</span><span class="p">,</span><span class="s1">&#39;hru&#39;</span><span class="p">:</span> <span class="n">hrud</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">:</span><span class="n">forc_sim</span><span class="p">}</span>
<span class="n">error_data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">comp_sim</span><span class="p">:</span>
    <span class="n">error_data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
                                 <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span>
                                 <span class="n">name</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<br>
Now run the actual computations on KGE. 
This takes 6 minutes on 4 HRUs for the lhc_config problem, and less for the smaller problems. <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">truth0_0</span> <span class="o">=</span> <span class="n">sim_truth</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="s1">&#39;hruId&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">forc_sim</span><span class="p">:</span>
    <span class="n">truth</span> <span class="o">=</span> <span class="n">truth0_0</span>
    <span class="c1">#truth = truth.isel(time = slice(365*24,(365*6+2)*24))+small_add #don&#39;t include first year, 5 years</span>
    <span class="n">truth</span> <span class="o">=</span> <span class="n">truth</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">365</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="n">small_add</span> 
    <span class="n">sim</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">top_folder</span><span class="o">+</span><span class="s1">&#39;/output/merged_day/NLDASconstant_&#39;</span> <span class="o">+</span> <span class="n">v</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">)</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="s1">&#39;hruId&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="c1">#sim = sim.isel(time = slice(365*24,(365*6+2)*24))+small_add #don&#39;t include first year, 5 years</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">365</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="n">small_add</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span> <span class="c1">#to set up xarray since xr.dot not supported on dataset and have to do loop</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">var_sim</span><span class="p">:</span>         
        <span class="n">r</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">correlation</span><span class="p">(</span><span class="n">sim</span><span class="p">[</span><span class="n">s</span><span class="p">],</span><span class="n">truth</span><span class="p">[</span><span class="n">s</span><span class="p">],</span><span class="n">dims</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> 
        <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span> <span class="n">sim</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">/</span><span class="n">truth</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> 
        <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span> <span class="n">sim</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">/</span><span class="n">truth</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">ds0</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">comp_sim</span><span class="p">:</span>
        <span class="n">error_data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:,</span><span class="n">v</span><span class="p">]</span>  <span class="o">=</span> <span class="n">ds0</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>windspd
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SWRadAtm
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>spechum
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pptrate
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LWRadAtm
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>airtemp
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>airpres
CPU times: user 29.7 s, sys: 1.9 s, total: 31.6 s
Wall time: 31.7 s
</pre></div>
</div>
</div>
</div>
<br>
<p>Now summarize this by totals over all output variables and each output variable, and ranks each constant forcing from most error to least error.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># setup summaries by simulated output variable</span>
<span class="n">summ_kind</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">,</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span>
<span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decision_set</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">hrud</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">summ_kind</span><span class="p">))</span>
<span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;decision&#39;</span><span class="p">,</span><span class="s1">&#39;hru&#39;</span><span class="p">,</span><span class="s1">&#39;var&#39;</span><span class="p">,</span><span class="s1">&#39;summary&#39;</span><span class="p">)</span>
<span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;decision&#39;</span><span class="p">:</span><span class="n">decision_set</span><span class="p">,</span><span class="s1">&#39;hru&#39;</span><span class="p">:</span> <span class="n">the_hru</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">:</span> <span class="n">forc_sim</span><span class="p">,</span><span class="s1">&#39;summary&#39;</span><span class="p">:</span><span class="n">summ_kind</span><span class="p">}</span>
<span class="n">rank_data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">)</span>
<span class="n">rank_data</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
                                 <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span>
                                 <span class="n">name</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">comp_sim</span><span class="p">:</span>
    <span class="n">rank_data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
                                 <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span>
                                 <span class="n">name</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate sums of KGE and ranks of worst to best forcing for error over all variables</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">error_data</span>
<span class="n">ds</span> <span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># So don&#39;t add to total KGE    </span>
<span class="n">ds1</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">var</span> <span class="o">=</span> <span class="n">forc_sim</span><span class="p">)]</span>
<span class="n">ds1</span> <span class="o">=</span> <span class="n">ds1</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds1</span><span class="o">&gt;-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#make the very negative values be -1</span>
<span class="n">ds2</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ds1</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">rank_data</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:,:,</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds2</span><span class="o">.</span><span class="n">values</span>
<span class="n">rank_data</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:,:,</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds2</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;var&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">comp_sim</span><span class="p">:</span>
    <span class="n">rank_data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:,:,</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds1</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">rank_data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:,:,</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds1</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;var&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
</div>
<br>
Let's first look at the error as a total over the simulated variables (14 of them not including the forcings), with just the default parameters and configurations. Each row is a basin here, and the worse the KGE (more error) the shorter the bar. KGE does not need to be normalized. We plot the HRU error as stack of values, with no error plotting as a height of 1 for that color. Values less than 0 are plotted as 0. <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup plots</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hrud</span><span class="p">))</span>
<span class="n">col_forc</span> <span class="o">=</span> <span class="n">col1</span>
<span class="n">letter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;</span><span class="p">)</span>
<span class="n">wid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_sim</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
<span class="n">inc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hrud</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
<span class="k">if</span> <span class="n">inc</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">inc</span><span class="o">=</span><span class="mi">1</span>
<span class="n">ytic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">hrud</span><span class="p">),</span><span class="n">inc</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">ytic</span> <span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ytic</span><span class="p">]</span>
<span class="n">ytics</span> <span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ytic</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span><span class="p">[</span><span class="s2">&quot;V&quot;</span><span class="o">+</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ytics</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">wid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">summ_kind</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
<span class="n">plot1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">summ_kind</span><span class="p">):</span>  
    <span class="n">plot2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">wid</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rank_data</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">default_name</span><span class="p">,:,:,</span><span class="n">t</span><span class="p">]</span>    
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">height</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">v</span><span class="p">]</span><span class="o">/</span><span class="mi">14</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">j</span><span class="o">+.</span><span class="mi">5</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">col_forc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">bottom</span> <span class="o">=</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s1">&#39;rank&#39;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">height</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">v</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">col_forc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">bottom</span> <span class="o">=</span> <span class="n">y</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="n">letter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;) &#39;</span><span class="o">+</span><span class="s1">&#39;Total over Output Variables&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">))</span>       
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ytic</span><span class="p">))</span>   
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">ytic</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">)</span><span class="o">+.</span><span class="mi">01</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">which</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;CAMELS basin (&quot;</span><span class="o">+</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">word</span> <span class="o">=</span> <span class="s2">&quot;KGE sum&quot;</span>
    <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s1">&#39;rank&#39;</span><span class="p">:</span> <span class="n">word</span> <span class="o">=</span> <span class="s2">&quot;Rank (in order of most to least error)&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">4</span><span class="p">)</span>

<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([],[],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">col_forc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;constant_&#39;</span> <span class="o">+</span>  <span class="n">v</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figlegend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;center right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/camels_analyze_output_26_0.png" src="_images/camels_analyze_output_26_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 510 ms, sys: 39.9 ms, total: 550 ms
Wall time: 548 ms
</pre></div>
</div>
</div>
</div>
<br>
<p>Constant air pressure has almost a perfect KGE in the example basins. Now look at it by simulated variable instead of total.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">wid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comp_sim</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plot1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">comp_sim</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rank_data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">default_name</span><span class="p">,:,:,</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span>  
    <span class="n">plot2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">wid</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">height</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">v</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">col_forc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">bottom</span> <span class="o">=</span> <span class="n">y</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="n">letter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;) &#39;</span><span class="o">+</span><span class="n">s</span><span class="p">[</span><span class="mi">6</span><span class="p">:])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">))</span>       
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ytic</span><span class="p">))</span>   
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">ytic</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">)</span><span class="o">+.</span><span class="mi">01</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">which</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;CAMELS basin (&quot;</span><span class="o">+</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>
    <span class="n">word</span> <span class="o">=</span> <span class="s2">&quot;Rank (in order of most to least error)&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">4</span><span class="p">)</span>

<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([],[],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">col_forc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;constant_&#39;</span> <span class="o">+</span>  <span class="n">v</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figlegend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;center right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/conda/envs/pysumma/lib/python3.7/site-packages/ipykernel_launcher.py:6: MatplotlibDeprecationWarning: Passing non-integers as three-element position specification is deprecated since 3.3 and will be removed two minor releases later.
  
</pre></div>
</div>
<img alt="_images/camels_analyze_output_28_1.png" src="_images/camels_analyze_output_28_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 1.62 s, sys: 111 ms, total: 1.73 s
Wall time: 1.7 s
</pre></div>
</div>
</div>
</div>
<br>
<p>Now we add up the HRUs that have each forcing ranked as 1, 2, … 7, sequentially for each simulated variable, and plot it as number of HRUS at with a forcing at each ranking. We normalize the sum of the number of HRUs by the number counted, so if there are ties in an HRU’s rankings, there will be a fewer HRUs in the count. For example, if their is no Surface Runoff for an HRU with a particular decision, all forcings will result in a perfect KGE of 1, and all will be ranked as 4. Thus, the Rank 1 plot will not have a contribution from this HRU.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup plots</span>
<span class="n">wid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">)</span>
<span class="n">tal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">comp_sim</span><span class="p">)</span>
<span class="n">ndec</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">config_num</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ndec</span><span class="p">)</span>
<span class="n">inc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ndec</span><span class="o">/</span><span class="n">config_num</span><span class="p">)</span>
<span class="k">if</span> <span class="n">inc</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">inc</span><span class="o">=</span><span class="mi">1</span>
<span class="n">xtic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ndec</span><span class="p">,</span><span class="n">inc</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">xtic</span> <span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xtic</span><span class="p">]</span>
<span class="n">xtics</span> <span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xtic</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span><span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="o">+</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xtics</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">plot1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">comp_sim</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">)):</span>
        <span class="n">plot2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">tal</span><span class="p">,</span><span class="n">wid</span><span class="p">,</span><span class="n">i</span><span class="o">*</span><span class="n">wid</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
      
        <span class="n">data</span> <span class="o">=</span> <span class="n">rank_data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">default_name</span><span class="p">,:,:,</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="o">==</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;hru&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">/</span><span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;var&#39;</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">hrud</span><span class="p">)</span>
        <span class="n">data_Master</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ndec</span>
        <span class="k">for</span> <span class="n">jj</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">)):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">height</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">col_forc</span><span class="p">[</span><span class="o">-</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bottom</span> <span class="o">=</span> <span class="n">data_Master</span><span class="p">)</span>
            <span class="n">data_Master</span> <span class="o">=</span> <span class="n">data_Master</span><span class="o">+</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="n">letter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">letter</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;) &#39;</span><span class="o">+</span><span class="n">s</span><span class="p">[</span><span class="mi">6</span><span class="p">:])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">ndec</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">hrud</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">xtic</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">hrud</span><span class="p">)</span><span class="o">+.</span><span class="mi">01</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">which</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Decisions (&quot;</span><span class="o">+</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;-D&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ndec</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Rank &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">4</span><span class="p">)</span>

<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([],[],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">col_forc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;constant_&#39;</span> <span class="o">+</span>  <span class="n">v</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figlegend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;center right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/camels_analyze_output_31_0.png" src="_images/camels_analyze_output_31_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 10.3 s, sys: 212 ms, total: 10.5 s
Wall time: 10.5 s
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="differences-in-parameter-space-and-model-configuration">
<h2><span class="section-number">3.4. </span>Differences in Parameter Space and Model Configuration<a class="headerlink" href="#differences-in-parameter-space-and-model-configuration" title="Permalink to this headline">¶</a></h2>
<p>We can plot the summation patterns plotted earlier for each decision. A decision is a combination of Latin Hypercube parameter set and model configuration choice. We plot blocks of model configurations on the x-axis, so each configuration has 11 LHC parameter sets associated with it for 11 vertical bars with each. If the model configurations were run, there are 8 configurations. Based on the paper results, we might expect to see more differences across model configurations but not many across the parameter space. So, every block of 11 parameter sets will set itself somewhat apart. First, we just plot the default model configuration. The default parameters will show up as the first parameter set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup plots</span>
<span class="k">if</span> <span class="n">lhc_prob</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">lhc_config_prob</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">wid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">)</span>
    <span class="n">tal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">comp_sim</span><span class="p">)</span>
    <span class="n">ndec</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">config_num</span> <span class="o">=</span> <span class="n">ndec</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ndec</span><span class="p">)</span>
    <span class="n">inc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ndec</span><span class="o">/</span><span class="n">config_num</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">inc</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">inc</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">xtic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ndec</span><span class="p">,</span><span class="n">inc</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">xtic</span> <span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xtic</span><span class="p">]</span>
    <span class="n">xtics</span> <span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xtic</span><span class="p">]</span>
    <span class="n">labels</span> <span class="o">=</span><span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="o">+</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xtics</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="k">if</span> <span class="n">lhc_prob</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">lhc_config_prob</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">plot1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">comp_sim</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">)):</span>
            <span class="n">plot2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">tal</span><span class="p">,</span><span class="n">wid</span><span class="p">,</span><span class="n">i</span><span class="o">*</span><span class="n">wid</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">rank_data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lat_name</span><span class="p">,:,:,</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="o">==</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;hru&#39;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">/</span><span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;var&#39;</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">hrud</span><span class="p">)</span>
            <span class="n">data_Master</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ndec</span>
            <span class="k">for</span> <span class="n">jj</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">)):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">height</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">v</span><span class="p">],</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">col_forc</span><span class="p">[</span><span class="o">-</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bottom</span> <span class="o">=</span> <span class="n">data_Master</span><span class="p">)</span>
                <span class="n">data_Master</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data_Master</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">v</span><span class="p">])]</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="n">letter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">letter</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;) &#39;</span><span class="o">+</span><span class="n">s</span><span class="p">[</span><span class="mi">6</span><span class="p">:])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">ndec</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">hrud</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">xtic</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">hrud</span><span class="p">)</span><span class="o">+.</span><span class="mi">01</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">which</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Decisions (&quot;</span><span class="o">+</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;-D&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ndec</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Rank &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([],[],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">col_forc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;constant_&#39;</span> <span class="o">+</span>  <span class="n">v</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figlegend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;center right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/camels_analyze_output_35_0.png" src="_images/camels_analyze_output_35_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 13.5 s, sys: 289 ms, total: 13.8 s
Wall time: 13.8 s
</pre></div>
</div>
</div>
</div>
<br>
Now, if we calculated it, we can plot the full problem with all model configurations. The default will show up as block 4. <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup plots</span>
<span class="k">if</span> <span class="n">lhc_config_prob</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">wid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">)</span>
    <span class="n">tal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">comp_sim</span><span class="p">)</span>
    <span class="n">ndec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">decision_set</span><span class="p">)</span>
    <span class="n">config_num</span> <span class="o">=</span> <span class="n">ndec</span><span class="o">/</span><span class="mi">11</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ndec</span><span class="p">)</span>
    <span class="n">inc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ndec</span><span class="o">/</span><span class="n">config_num</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">inc</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">inc</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">xtic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ndec</span><span class="p">,</span><span class="n">inc</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">xtic</span> <span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xtic</span><span class="p">]</span>
    <span class="n">xtics</span> <span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xtic</span><span class="p">]</span>
    <span class="n">labels</span> <span class="o">=</span><span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="o">+</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xtics</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="k">if</span> <span class="n">lhc_config_prob</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">plot1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">comp_sim</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">)):</span>
            <span class="n">plot2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">tal</span><span class="p">,</span><span class="n">wid</span><span class="p">,</span><span class="n">i</span><span class="o">*</span><span class="n">wid</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">rank_data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:,:,</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="o">==</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;hru&#39;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">/</span><span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;var&#39;</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">hrud</span><span class="p">)</span>
            <span class="n">data_Master</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ndec</span>
            <span class="k">for</span> <span class="n">jj</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">)):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">height</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">v</span><span class="p">],</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">col_forc</span><span class="p">[</span><span class="o">-</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bottom</span> <span class="o">=</span> <span class="n">data_Master</span><span class="p">)</span>
                <span class="n">data_Master</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data_Master</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">v</span><span class="p">])]</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="n">letter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">letter</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;) &#39;</span><span class="o">+</span><span class="n">s</span><span class="p">[</span><span class="mi">6</span><span class="p">:])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">ndec</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">hrud</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">xtic</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">hrud</span><span class="p">)</span><span class="o">+.</span><span class="mi">01</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">which</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Decisions (&quot;</span><span class="o">+</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;-D&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ndec</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Rank &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">forc_sim</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([],[],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">col_forc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;constant_&#39;</span> <span class="o">+</span>  <span class="n">v</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figlegend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;center right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/camels_analyze_output_38_0.png" src="_images/camels_analyze_output_38_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 17.9 s, sys: 229 ms, total: 18.1 s
Wall time: 18.1 s
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "DavidChoi76/pysumma_tutorial_jupyterbook.git",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "pysumma"
        },
        kernelOptions: {
            kernelName: "pysumma",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'pysumma'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="camels_pysumma.html" title="previous page"><span class="section-number">2. </span>Running SUMMA using pySUMMA</a>
    <a class='right-next' id="next-link" href="SummaModel_ReynoldsAspennStand_StomatalResistance_Basic_Plot.html" title="next page"><span class="section-number">1. </span>Modeling the Impact of Simlpe Soil Resistance method on Total Evapotranspiration in the Reynolds Mountain East catchment using pySUMMA</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By YoungDon Choi, Andrew Bennett<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>